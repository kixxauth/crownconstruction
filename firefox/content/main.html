<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Crown Construction ERM</title>
  <link type="text/css" href="css/jui/jquery-ui-1.8.1.custom.css" rel="stylesheet" />	
  <link type="text/css" href="css/main.css" rel="stylesheet" />	
  <script src="jquery-1.4.2.min.js" type="application/javascript"></script>
	<!--
  <script src="jquery-ui-1.8.1.custom.min.js" type="application/javascript"></script>
	<script type="text/javascript" src="jquery.ba-bbq.js"></script>
  <script src="underscore.js" type="application/javascript"></script>
  <script src="resource://crownconstruction/modules/jmonad.js" type="application/javascript"></script>
  <script src="main.js" type="application/javascript;version=1.7"></script>
	-->
  <script type="application/javascript;version=1.7">
    $(function () {

      function channel_listener(evt) {
        dump($(this).attr('x-response') +'\n');
      }

      $(window).bind('x-channelopen', function () {
        var channel = $('channel'),

          messageEvent = document.createEvent('Event'),

          request = JSON.stringify({
            resource: 'cache/users',
            method: 'get'
          });

        channel.bind('x-response', channel_listener);
        channel.bind('x-request', function () { dump('sent request\n'); });
        channel.attr('x-request', request);
        messageEvent.initEvent('x-request', true, true);
        channel[0].dispatchEvent(messageEvent);
      });
    });
  </script>
</head>
<body>
<div id="init-decks" class="ui-corner-all" style="display:block">
	<div id="login-header" class="ui-corner-all">
		<img id="weblogo" src="img/weblogo.gif" width="291" height="120" />
		<h1 class="ui-corner-bottom">Enterprise Resource Management System</h1>
	</div>

	<!-- blank deck -->
	<div id="deck-0" style="display:block">
		<div id="init_progress_bar"></div>
	</div>
	<!-- end deck-0 -->

	<!-- choose user deck -->
	<div id="deck-1" class="ui-corner-all" style="display:none">
		<h3>Choose a logged in user...</h3>
		<div id="user_list"></div>
		<h3>or...</h3>
		<button id="show_login" class="ui-corner-all">Login a different user.</button>
	</div>
	<!-- end deck-1 -->

	<!-- login deck -->
	<div id="deck-2" class="ui-corner-all" style="display:none">
		<form id="login">
			<table>
				<tr class="login-input-line">
					<td>
						<label id="label-username" for="username" class="login login-normal">Username:</label>
					</td>
					<td>
						<input id="username" name="username" class="login login-normal" type="text" />
					</td>
					<td>
						<span id="warn-username" class="login-warning"></span>
					</td>
				</tr>
				<tr class="login-input-line">
					<td>
						<label id="label-passkey" for="passkey" class="login login-normal">Passkey:</label>
					</td>
					<td>
						<input id="passkey" name="passkey" class="login login-normal" type="password" />
					</td>
					<td>
						<span id="warn-passkey" class="login-warning"></span>
					</td>
				</tr>
				<tr id="login-submit-line">
					<td>
						<button id="login-button" class="ui-corner-all" type="submit">
							Login
						</button>
						<img id="login_busy_spinner" style="display:none"
							src="css/images/ui-anim_basic_16x16.gif" width="16" height="16" />
					</td>
					<td colspan="2">
						<label id="label-db" for="use-fake-db">Use fake database:</label>
						<input id="use-fake-db" name="use-fake-db" type="checkbox" />
					</td>
				</tr>
			</table>
			<p id="warn-login" class="login-warning"></p>
		</form>
	</div>
	<!-- end deck-2 -->

	<div id="login_offline-dialog" class="dialog" style="display:none">
		<p class="dialog-content">
			The Crown Construction ERM cannot connect to the Internet. Try to visit a
			popular web page in your web browser to see if you have an internet
			connection. If you have lost connection, you'll need to get it back
			before trying to log in again.
		</p>
	</div>

	<div id="login_unexpected-dialog" class="dialog"  style="display:none">
		<p class="dialog-content">
			A problem has been detected but the cause cannot be determined. The error
			message has already been logged to the black box to help diagnose the
			problem.  The best thing to do at this point is to contact a support
			person.
		</p>
	</div>

	<div id="login_null_db-dialog" class="dialog"  style="display:none">
		<p class="dialog-content">
			The database you are trying to reach does not exist. If you think this might
			be an error, please contact a support person.
		</p>
	</div>

</div><!-- end init-decks -->

<!-- main app -->
<div id="main" style="display:none">
	<div id="notify-unsaved" class="ui-corner-bl" style="display:none">
		<span></span>
		<h3>Unsaved changes.</h3>
		Press shift+enter or click here to save.
	</div>
	<div id="tabs" class="bbq ui-widget ui-widget-content ui-corner-bottom">
		<ul id="tab-nav">
			<li>
				<a href="#customers" class="ui-corner-top">customers</a>
			</li>
			<li>
				<a href="#jobs" class="ui-corner-top">jobs</a>
			</li>
		</ul>
		<div id="tab-customers" class="tab bbq">
			<ul class="actions">
				<li><span class="ui-icon ui-icon-newwin"></span><a href="#new">New</a></li>
				<li><span class="ui-icon ui-icon-zoomin"></span><a href="#find">Find</a></li>
			</ul>
			<div id="customer_form" class="tabpanel">
			</div>
		</div>
		<div id="tab-jobs" class="tab bbq">
			<ul class="actions">
				<li><span class="ui-icon ui-icon-newwin"></span><a href="#new">New</a></li>
				<li><span class="ui-icon ui-icon-zoomin"></span><a href="#find">Find</a></li>
			</ul>
			<div id="job_form" class="tabpanel">
			</div>
		</div>
	</div>
</div>
<!-- end main -->

<!-- templates -->
<script type="text/html" id="customer_names-template">
	<% var i = 0, len = names.length, name; %>
	<div class="form-sub-section ui-corner-all">
		<h4 class="form-sub-section-header ui-corner-top">Names</h4>

		<% for (; i < len; i += 1) { %>
		<% name = names[i];  %>
		<div class="input-section ui-corner-all">
			<div class="line ui-helper-clearfix">
				<p class="input-float"><label class="live-label">last:</label>
					<input size="30" class="clean-text-input bbqpork" type="text"
						name="<%= name.last.path %>" value="<%= name.last.value %>" />
				</p>
			</div>
			<div class="line ui-helper-clearfix">
				<p class="input-float"><label class="live-label">first:</label>
					<input size="30" class="clean-text-input bbqpork" type="text"
						name="<%= name.first.path %>" value="<%= name.first.value %>" />
				</p>
			</div>
		</div>
		<% } %>

		<button class="bbqbeef form-sub-section-footer-ctn button ui-corner-all"
				 title="Add another contact person." name="names">
			<span class="ui-icon ui-icon-circle-plus"></span>
			Add another contact person.
		</button>

	</div>
</script>

<script type="text/html" id="customer_addresses-template">
	<% var i = 0, len = addresses.length, address; %>
	<div class="form-sub-section ui-corner-all">
		<h4 class="form-sub-section-header ui-corner-top">Addresses</h4>

		<% for (; i < len; i += 1) { %>
		<% address = addresses[i]; %>
		<div class="input-section ui-corner-all">
			<div class="line">
				<p>
					<label class="live-label">street:</label>
					<input size="30" class="clean-text-input bbqpork" type="text"
						name="<%= address.street.path %>" value="<%= address.street.value %>" />
				</p>
			</div>
			<div class="line ui-helper-clearfix">
				<p class="input-float">
					<label class="live-label">city:</label>
					<input size="30" class="clean-text-input bbqpork" type="text"
						name="<%= address.city.path %>" value="<%= address.city.value %>" />
				</p>
			</div>
			<div class="line ui-helper-clearfix">
				<p class="input-float">
					<label class="live-label">state:</label>
					<input size="2" class="clean-text-input bbqpork" type="text"
						name="<%= address.state.path %>" value="<%= address.state.value %>" />
				</p>
				<p class="input-float">
					<label class="live-label">zip:</label>
					<input size="16" class="clean-text-input bbqpork" type="text"
						name="<%= address.zip.path %>" value="<%= address.zip.value %>" />
				</p>
			</div>
		</div>
		<% } %>

		<button class="bbqbeef form-sub-section-footer-ctn button ui-corner-all"
				 title="Add another customer address." name="addresses">
			<span class="ui-icon ui-icon-circle-plus"></span>
			Add another customer address.
		</button>
	</div>
</script>

<script type="text/html" id="customer_phones-template">
	<% var i = 0, len = phones.length, phone; %>
	<div class="form-sub-section ui-corner-all">
		<h4 class="form-sub-section-header ui-corner-top">Phone Numbers</h4>

		<% for (; i < len; i += 1) { %>
		<% phone = phones[i]; %>
		<div class="input-section ui-corner-all">
			<div class="line ui-helper-clearfix">
				<p class="input-float">
					<label class="live-label">number:</label>
					<input size="24" class="clean-text-input bbqpork" type="text"
						name="<%= phone.phone.path %>" value="<%= phone.phone.value %>" />
				</p>
			</div>
			<div class="line ui-helper-clearfix">
				<p class="input-float">
					<label class="live-label">label:</label>
					<input size="24" class="clean-text-input bbqpork" type="text"
						name="<%= phone.label.path %>" value="<%= phone.label.value %>" />
				</p>
			</div>
		</div>
		<% } %>

		<button class="bbqbeef form-sub-section-footer-ctn button ui-corner-all"
				 title="Add another phone number." name="phones">
			<span class="ui-icon ui-icon-circle-plus"></span>
			Add another phone number.
		</button>
	</div>
</script>

<script type="text/html" id="customer_emails-template">
	<% var i = 0, len = emails.length, email; %>
	<div class="form-sub-section ui-corner-all">
		<h4 class="form-sub-section-header ui-corner-top">Email Addresses</h4>

		<% for (; i < len; i += 1) { %>
		<% email = emails[i]; %>
		<div class="input-section ui-corner-all">
			<div class="line ui-helper-clearfix">
				<p class="input-float">
					<label class="live-label">email:</label>
					<input size="24" class="clean-text-input bbqpork" type="text"
						name="<%= email.email.path %>" value="<%= email.email.value %>" />
				</p>
			</div>
			<div class="line ui-helper-clearfix">
				<p class="input-float">
					<label class="live-label">label:</label>
					<input size="24" class="clean-text-input bbqpork" type="text"
						name="<%= email.label.path %>" value="<%= email.label.value %>" />
				</p>
			</div>
		</div>
		<% } %>

		<button class="bbqbeef form-sub-section-footer-ctn button ui-corner-all"
				 title="Add another email address." name="emails">
			<span class="ui-icon ui-icon-circle-plus"></span>
			Add another email address.
		</button>
	</div>
</script>

<script type="text/html" id="customer_results-template">
	<% var key, customer; %>
	<ul>
		<% for (key in customers) { %>
		<% if (Object.prototype.hasOwnProperty.call(customers, key)) { %>
		<% customer = customers[key]; %>
		<li>
			<a href="#show?key=<%= key %>"><%= customer.lastname %></a>
		</li>
		<% } %>
		<% } %>
	</ul>
</script>

<script type="text/html" id="job_header-template">
	<div class="form-sub-section">
		<div class="form-sub-section-head-ctn">
			<h4 class="form-sub-section-header">Job Header</h4>
		</div>

		<div class="input-section ui-corner-all">
			<div class="line ui-helper-clearfix">
				<p class="input-float">
					<span>job ID:</span>
					<span class="computed">job<%= id.value %></span>
				</p>
				<p class="input-float">
					<span>cost of contract:</span>
					<span name="cost-of-contract" class="computed">0</span>
				</p>
			</div>
			<div class="line ui-helper-clearfix">
				<p class="input-float">
					<label>start by:</label>
					<input class="clean-text-input bbqpork" type="text"
						name="<%= startdate.path %>" value="<%= startdate.value %>" />
				</p>
				<p class="input-float">
					<label>complete:</label>
					<input class="clean-text-input bbqpork" type="text"
						name="<%= completedate.path %>" value="<%= completedate.value %>" />
				</p>
			</div>
		</div>
	</div>
</script>

<script type="text/html" id="job_results-template">
	<% var key, job; %>
	<ul>
		<% for (key in jobs) { %>
		<% if (Object.prototype.hasOwnProperty.call(jobs, key)) { %>
		<% job = jobs[key]; %>
		<li>
			<a href="#show?key=<%= key %>"><%= job.id %></a>
		</li>
		<% } %>
		<% } %>
	</ul>
</script>

<script type="text/html" id="new_job_customer_results-template">
	<% var key, customer; %>
	<ul>
		<% for (key in customers) { %>
		<% if (Object.prototype.hasOwnProperty.call(customers, key)) { %>
		<% customer = customers[key]; %>
		<li>
			<a href="#new?key=<%= key %>"><%= customer.lastname %></a>
		</li>
		<% } %>
		<% } %>
	</ul>
</script>

<script type="text/html" id="user_list-template">
	<% var user, i = 0, len = users.length; %>
	<ul>
		<% for (; i < len; i += 1) { %>
		<% user = users[i]; %>
		<li>
			<a class="button ui-corner-all" href="<%= user.dbname %>/<%= user.username %>"><%= user.username %></a>
		</li>
		<% } %>
	</ul>
</script>

<!-- end templates -->
</body>
</html>
